<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supplement Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#121212" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #f5f5f5;
    }
    header {
      text-align: center;
      padding: 1em;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 1em;
    }
    .day-selector {
      display: flex;
      justify-content: center;
      gap: 1em;
      margin-bottom: 1em;
    }
    .supplement {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #1e1e1e;
      padding: 0.75em 1em;
      border-radius: 12px;
      margin: 0.5em 0;
      opacity: 1;
      transition: 0.3s;
    }
    .supplement.paused {
      opacity: 0.4;
    }
    .supplement span.icon {
      margin-left: 0.5em;
    }
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 1em;
      border-radius: 10px;
      padding: 0.5em;
      background: #1e1e1e;
      color: #f5f5f5;
      border: none;
    }
    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 1em;
    }
    .action-buttons button {
      padding: 0.5em 1em;
      border-radius: 10px;
      background-color: #333;
      color: #fff;
      border: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Supplement Tracker</h1>
  </header>
  <div class="container">
    <div class="day-selector">
      <button onclick="setDayType('training')">Training</button>
      <button onclick="setDayType('rest')">Ruhetag</button>
    </div>
    <div id="supplements"></div>
    <textarea id="notes" placeholder="Notizen f√ºr heute..."></textarea>
    <div class="action-buttons">
      <button onclick="exportData()">Daten exportieren</button>
      <input type="file" accept=".json" onchange="importData(event)" />
    </div>
  </div>
  <script>
    const defaultSupplementPlan = [
      { name: "Vitamin B12", time: "‚è∞", icon: "ü©∏", cycle: false },
      { name: "Ashwagandha", time: "‚è∞", icon: "üßò", cycle: { on: 42, off: 14, key: "ashwagandha" } },
      { name: "D3 + K2", time: "‚è∞", icon: "ü¶¥", cycle: { on: 56, off: 14, key: "d3" } },
      { name: "Omega 3", time: "‚è∞", icon: "üß†", cycle: { on: 42, off: 7, key: "omega" } },
      { name: "Magnesium", time: "üåô", icon: "üí§", cycle: false },
      { name: "Creatin", time: "üèÉ", icon: "üèãÔ∏è", cycle: { on: 42, off: 14, key: "creatine" }, onlyTraining: true },
      { name: "Citrullin", time: "üèÉ", icon: "üí™", cycle: false, onlyTraining: true },
      { name: "Whey Shake", time: "ü§Ø", icon: "ü•§", cycle: false, swapTimeOnRest: "‚è∞" },
      { name: "Whey Night", time: "üò¥", icon: "ü•§üí§", cycle: false, onlyTraining: true }
    ];

    let supplementPlan = [...defaultSupplementPlan];

    const dayData = JSON.parse(localStorage.getItem('trackerData')) || {
      dayCount: 0,
      cycles: {
        creatine: 0,
        omega: 0,
        d3: 0,
        ashwagandha: 0
      },
      history: []
    };

    function setDayType(type) {
      dayData.dayCount++;
      const today = { type, supplements: {}, notes: "" };
      supplementPlan = [...defaultSupplementPlan];
      if (type === 'rest') {
        supplementPlan.sort((a, b) => {
          if (a.name === "Whey Shake") return -1;
          if (b.name === "Whey Shake") return 1;
          return 0;
        });
      }
      supplementPlan.forEach(sup => {
        const key = sup.name;
        if (sup.onlyTraining && type === 'rest') {
          today.supplements[key] = false;
          return;
        }
        if (sup.cycle) {
          const cycleDay = ++dayData.cycles[sup.cycle.key];
          const paused = cycleDay > sup.cycle.on && cycleDay <= (sup.cycle.on + sup.cycle.off);
          if (cycleDay > (sup.cycle.on + sup.cycle.off)) {
            dayData.cycles[sup.cycle.key] = 1;
          }
          today.supplements[key] = !paused;
        } else {
          today.supplements[key] = true;
        }
      });
      dayData.history.push(today);
      localStorage.setItem('trackerData', JSON.stringify(dayData));
      renderSupplements(today);
    }

    function renderSupplements(today) {
      const container = document.getElementById('supplements');
      container.innerHTML = '';
      supplementPlan.forEach(sup => {
        const key = sup.name;
        const isActive = today.supplements[key];
        let displayTime = sup.time;
        if (sup.swapTimeOnRest && today.type === 'rest') {
          displayTime = sup.swapTimeOnRest;
        }
        const div = document.createElement('div');
        div.className = 'supplement' + (isActive ? '' : ' paused');
        div.innerHTML = `
          <label>
            <input type="checkbox" ${!isActive ? 'disabled' : ''}>
            ${sup.icon} ${sup.name} <span class="icon">${isActive ? displayTime : '‚è∏Ô∏è'}</span>
          </label>
        `;
        container.appendChild(div);
      });
      document.getElementById('notes').value = today.notes;
    }

    function exportData() {
      const blob = new Blob([JSON.stringify(dayData)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'trackerData.json';
      a.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const content = e.target.result;
        try {
          const data = JSON.parse(content);
          localStorage.setItem('trackerData', JSON.stringify(data));
          location.reload();
        } catch (err) {
          alert('Fehler beim Import: Ung√ºltige Datei');
        }
      };
      reader.readAsText(file);
    }

    if (dayData.history.length > 0) {
      renderSupplements(dayData.history[dayData.history.length - 1]);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
